<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <link href="../../assets/css/style_admin.css" rel="stylesheet">
        <link href="../../assets/css/style.css" rel="stylesheet">
        <link href="../../assets/images/favico.ico" rel="icon">
        <title>Administration | Makerhub</title>
    </head>

    <body>
    <div class="navbar">
        <div class="header-logo">
            <img alt="Logo MakerHUB" class="img-logo" src="../../assets/images/logo.svg">
        </div>

        <div class="profil" id="profil">
            <img alt="Photo de profil" class="img-profil" src="../../assets/images/profil.svg">
            <p id="pseudo">Panel</p>

            <div id="dropdown">
                <a href="panel_admin_faq.php" ><div class="drop-content">FAQ</div></a>
                <a href="panel_admin_produit.php" ><div class="drop-content">Produit</div></a>
                <a href="#supprimer-utilisateur" ><div class="drop-content">Utilisateur</div></a>
                <hr id="separation-bar">
                <a href="log-out.php" ><div class="drop-content logout">Se déconnecter</div></a>
            </div>
        </div>
    </div>

   <main class="main">
        <div class="mini-menu">
                <a href="panel_admin_faq.php" ><div class="submitButton">FAQ</div></a>
                <a href="panel_admin_produit.php" ><div class="submitButton">Produit</div></a>
        </div>
   

        <table>
            <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th></th>
            </tr>
            <?php
            foreach($users as $user) {
                $prenom = $user['prenom'];
                $nom = $user['nom'];
                $email = $user['mail'];
                $id = $user['id_utilisateur'];
            ?>
                <tr>
                    <td><?php echo($prenom);?></td>
                    <td><?php echo($nom);?></td>
                    <td><?php echo($email);?></td>
                    <td>
                        <a onclick="deleteUser(<?php echo($id); ?>)">
                            <button>
                                <i class="fa-regular fa-trash-can" style="color: #ffffff;">                                   
                                </i>
                            </button>
                        </a>
                    </td>
                </tr>
            <?php } ?>
        </table>


                <section id="supprimer-utilisateur" class="section content-box">
                    <h2>Utilisateurs</h2>
                    <form class="form-container" method="post" action="./php/user/getUser.php">
                        <label for="show_user">Rechercher un utilisateur</label>
                        <select name="show_user" autocomplete="on" required>
                            <option value=""> -- Sélectionner un utilisateur -- </option>
                            <?php foreach($users as $user) {
                                $id_user = $user['id_utilisateur'];
                                $email = $user['mail'];?>
                                <option value="<?php echo($id_user);?>"><?php echo($email);?></option>
                            <?php } ?>
                        </select>

                        <input class="submit" type="submit" value="Voir">
                        <!--onclick="showUser(<?php echo($users);?>,<?php echo($id_user);?>)"-->
                    </form>
                    <?php 
                    if (isset($_GET['user'])){
                        $user =  $_GET['user'];
                        $user = json_decode($user, true);
                        $prenom = $user['prenom'];
                        $nom = $user['nom'];
                        $email = $user['mail'];
                        $id = $user['id_utilisateur'];
                        $pseudo = $user['pseudonyme'];
                        $description = $user['description'];
                        $telephone = $user['telephone'];
                        
                    ?>
                    <div>
                        <p>Nom : <?php echo $nom;?></span></p>
                        <p>Prénom : <?php echo $prenom;?></span></p>
                        <p>Pseudonyme : <?php echo $pseudo;?></span> </p>
                        <p>Adresse email : <?php echo $email;?></span></p>
                        <p>Description : <?php echo $description;?></span></p>
                        <p>Téléphone : <?php echo $telephone;?></span></p>    
                    </div>
                    <?php } else {
                        echo "Aucun utilisateur sélectionné";
                    }?>
                </section>
    </main> 

    <script>
        
function deleteUser(id_param){
    confirmation = confirm("Êtes-vous sûr de vouloir supprimer cet utilisateur ?");
    if (confirmation){
        try{
            console.log(id);
            if (window.XMLHttpRequest) {
                xmlhttp= new XMLHttpRequest();
            } else {
                if (window.ActiveXObject)
                    try {
                        xmlhttp= new ActiveXObject("Msxml2.XMLHTTP");
                    } catch (e) {
                        try {
                            xmlhttp= new ActiveXObject("Microsoft.XMLHTTP");
                        } catch (e) {
                            return NULL;
                        }
                    }
            }
            xmlhttp.onreadystatechange = function ()
            {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
                {
                    console.log(xmlhttp.responseText);
                    console.log(xmlhttp);
                    window.location.reload();
                }
            }
            xmlhttp.open("POST","./php/user/deleteUser.php", true);
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.send("id="+id);
            console.log(xmlhttp);
            
            }
            catch(e){
            console.log(e);
            }
    }
}
    </script>